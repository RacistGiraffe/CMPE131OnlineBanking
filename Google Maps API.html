<!DOCTYPE html>
<html>
	<head>
		<title>My name a chef</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
			<meta charset="utf-8">
				<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 99%;
        margin: 0;
        padding: 0;
      }
</style>
<div>
<strong>Mode of Travel: </strong>
<select id="mode" onchange="calcRoute();">
  <option value="DRIVING">Driving</option>
  <option value="WALKING">Walking</option>
  <option value="BICYCLING">Bicycling</option>
  <option value="TRANSIT">Transit</option>
</select>
</div>
<script>
	//var markers = [];
	var map;
	var infowindow;
	var count2 = 0;
	var directionsDisplay;
	var directionsService;
	
		  
	function initMap() {
		//Boilerplate to set up default map
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 37.335480, lng: -121.893028},
          zoom: 17
        });
        infoWindow = new google.maps.InfoWindow;
		directionsDisplay = new google.maps.DirectionsRenderer();
		directionsService = new google.maps.DirectionsService();
		
		//After being granted access to location services, it will use geolocation to center the map to the current location
        
		
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position) 
				{
            pos = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
            infowindow = new google.maps.InfoWindow({map: map,position: pos,content: 'You Are Here'});
            var request = {location:pos,radius:2500,keyword: 'Chase ATM'};
            map.setCenter(pos);
			directionsDisplay.setMap(map);

			//Create "request" and use it to find nearby ATMs and pin markers on them
            infowindow = new google.maps.InfoWindow();
            var service = new google.maps.places.PlacesService(map);
            service.nearbySearch(request,callback);
				}, 

			function() { 
				handleNoGeolocation(true);
			});
			
		}

		else {
			handleNoGeolocation(false);
		}
	}
	  
	 
		function callback(results, status) {
			if (status == google.maps.places.PlacesServiceStatus.OK) {
			for (var i = 0; i < results.length; i++) {
			var place = results[i];
			createMarker(results[i]);
				}
			}
		}
		
       function createMarker(place) {
        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });
        google.maps.event.addListener(marker, 'click', function(event) {
			calcRoute(event.latLng);
        });
      }
	  
	  
	  function calcRoute(location) {
	  var selectedMode = document.getElementById('mode').value;
		var start = pos;
		var end = location;
		var request = {
			origin:start,
			destination:end,
			travelMode: google.maps.TravelMode[selectedMode]
		};
		directionsService.route(request, function(response, status) {
				if (status == 'OK') {
					directionsDisplay.setDirections(response);
				}
			});
		}
	  
							</script>
						</head>
						<body>
							<div id="map"/>
							<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDm454_Wl6l2VhNa-LfRVEQXq38j3cdpS8&libraries=places&callback=initMap" async defer></script>

						</body>
					</html>